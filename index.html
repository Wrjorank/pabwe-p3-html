<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
      /* Todo List specific styles */
      .sortable-ghost {
        opacity: 0.4;
        background-color: #f8f9fa;
      }
      .sortable-chosen {
        background-color: #e3f2fd;
      }
      .sortable-drag {
        background-color: #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      .drag-handle {
        cursor: grab;
      }
      .drag-handle:active {
        cursor: grabbing;
      }
      .todo-item {
        transition: all 0.3s ease;
      }
      .todo-item:hover {
        background-color: #f8f9fa;
      }
      .edit-mode {
        background-color: #fff3cd !important;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <ul class="nav nav-tabs mb-3" id="mainTabs">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="index.html">Todo List</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="magic-number.html">Magic Number</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="password-checker.html">Password Checker</a>
        </li>
      </ul>

      <div id="todo-list">
        <div class="row justify-content-center">
          <div class="col-md-10">
            <h1 class="text-start mb-4">Todo List</h1>
            
            <!-- Info Card -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="alert alert-info mb-0" role="alert">
                  <i class="bi bi-info-circle me-2"></i>
                  Ini merupakan aplikasi manajemen tugas sederhana yang memungkinkan Anda untuk menambah, mengedit, menghapus, dan mengatur todo dengan mudah. Anda dapat menambahkan deskripsi untuk setiap tugas, memfilter berdasarkan status, mencari tugas tertentu, dan mengatur ulang urutan dengan drag & drop. Semua data tersimpan di browser dan tidak akan hilang saat aplikasi ditutup.
                </div>
              </div>
            </div>

            <!-- Form untuk menambah todo -->
            <form id="todoFormData" class="mb-4">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Add New Todo</h5>
                  <div class="mb-3">
                    <label for="todoInput" class="form-label">
                      What's your next plan?
                    </label>
                    <input 
                      type="text" 
                      class="form-control" 
                      name="todo" 
                      id="todoInput"
                      placeholder="Enter your todo title..."
                    />
                    <div class="invalid-feedback" id="todoError"></div>
                  </div>
                  <div class="mb-3">
                    <label for="todoDescription" class="form-label">
                      Description (Optional)
                    </label>
                    <textarea 
                      class="form-control" 
                      name="description" 
                      id="todoDescription"
                      rows="2"
                      placeholder="Add more details about your todo..."
                    ></textarea>
                  </div>
                  <div class="d-grid">
                    <button type="submit" class="btn btn-primary">
                      <i class="bi bi-plus"></i> Add Todo
                    </button>
                  </div>
                </div>
              </div>
            </form>

            <!-- Filter dan Search -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <label for="filterSelect" class="form-label">Filter:</label>
                    <select class="form-select" id="filterSelect">
                      <option value="all">All Todos</option>
                      <option value="active">Active Todos</option>
                      <option value="completed">Completed Todos</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="searchInput" class="form-label">Search:</label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="searchInput"
                        placeholder="Search todos..."
                      />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        id="clearSearch"
                      >
                        <i class="bi bi-x"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Statistics -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="row text-center">
                  <div class="col-4">
                    <h5 class="text-primary" id="totalCount">0</h5>
                    <small class="text-muted">Total</small>
                  </div>
                  <div class="col-4">
                    <h5 class="text-warning" id="activeCount">0</h5>
                    <small class="text-muted">Active</small>
                  </div>
                  <div class="col-4">
                    <h5 class="text-success" id="completedCount">0</h5>
                    <small class="text-muted">Completed</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Todo List -->
            <div class="card">
              <div class="card-body">
                <h5 class="card-title d-flex align-items-center">
                  <i class="bi bi-list-task me-2"></i>
                  Todo Items
                  <small class="text-muted ms-2">(Drag to reorder)</small>
                </h5>
                <ul class="list-group list-group-flush" id="todoList">
                  <!-- Todos will be rendered here -->
                </ul>
                <div id="emptyState" class="text-center py-5" style="display: none">
                  <i class="bi bi-clipboard-x display-1 text-muted"></i>
                  <p class="text-muted mt-3">No todos found</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Todo List Application
      class TodoApp {
        constructor() {
          this.todos = [];
          this.currentFilter = "all";
          this.searchQuery = "";
          this.editingId = null;
          this.sortable = null;

          this.init();
        }

        init() {
          this.loadTodos();
          this.bindEvents();
          this.initSortable();
          this.render();
        }

        loadTodos() {
          const stored = JSON.parse(
            localStorage.getItem("enhancedTodos") || "[]"
          );
          this.todos = stored.map((todo, index) => ({
            ...todo,
            id: todo.id || Date.now() + index,
            order: todo.order !== undefined ? todo.order : index,
            description: todo.description || "" // Ensure description field exists
          }));

          this.todos.sort((a, b) => a.order - b.order);
        }

        saveTodos() {
          localStorage.setItem("enhancedTodos", JSON.stringify(this.todos));
        }

        bindEvents() {
          document
            .getElementById("todoFormData")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              this.addTodo();
            });

          document
            .getElementById("filterSelect")
            .addEventListener("change", (e) => {
              this.currentFilter = e.target.value;
              this.render();
            });

          document
            .getElementById("searchInput")
            .addEventListener("input", (e) => {
              this.searchQuery = e.target.value.toLowerCase().trim();
              this.render();
            });

          document
            .getElementById("clearSearch")
            .addEventListener("click", () => {
              document.getElementById("searchInput").value = "";
              this.searchQuery = "";
              this.render();
            });

          window.addEventListener("beforeunload", () => {
            this.saveTodos();
          });
        }

        initSortable() {
          const todoList = document.getElementById("todoList");
          this.sortable = Sortable.create(todoList, {
            animation: 150,
            ghostClass: "sortable-ghost",
            chosenClass: "sortable-chosen",
            dragClass: "sortable-drag",
            handle: ".drag-handle",
            onEnd: (evt) => {
              this.reorderTodos(evt.oldIndex, evt.newIndex);
            },
          });
        }

        addTodo() {
          const input = document.querySelector('input[name="todo"]');
          const descriptionInput = document.querySelector('textarea[name="description"]');
          const todoText = input.value.trim();
          const todoDescription = descriptionInput.value.trim();
          const errorDiv = document.getElementById("todoError");

          input.classList.remove("is-invalid");
          errorDiv.textContent = "";

          if (!todoText) {
            this.showError(input, errorDiv, "Todo title cannot be empty!");
            return;
          }

          if (
            this.todos.some(
              (todo) => todo.text.toLowerCase() === todoText.toLowerCase()
            )
          ) {
            this.showError(
              input,
              errorDiv,
              "Todo with this title already exists!"
            );
            return;
          }

          const newTodo = {
            id: Date.now(),
            text: todoText,
            description: todoDescription,
            completed: false,
            order: 0,
            createdAt: new Date().toISOString(),
          };

          this.todos.forEach((todo) => todo.order++);
          this.todos.unshift(newTodo);
          input.value = "";
          descriptionInput.value = "";
          this.saveTodos();
          this.render();
        }

        showError(input, errorDiv, message) {
          input.classList.add("is-invalid");
          errorDiv.textContent = message;
        }

        toggleTodo(id) {
          const todo = this.todos.find((t) => t.id === id);
          if (todo) {
            todo.completed = !todo.completed;
            this.saveTodos();
            this.render();
          }
        }

        deleteTodo(id) {
          if (confirm("Are you sure you want to delete this todo?")) {
            this.todos = this.todos.filter((t) => t.id !== id);
            this.saveTodos();
            this.render();
          }
        }

        editTodo(id) {
          this.editingId = id;
          this.render();
        }

        saveEdit(id, newText, newDescription = '') {
          const trimmedText = newText.trim();
          const trimmedDescription = newDescription.trim();

          if (!trimmedText) {
            alert("Todo title cannot be empty!");
            return false;
          }

          if (
            this.todos.some(
              (todo) =>
                todo.id !== id &&
                todo.text.toLowerCase() === trimmedText.toLowerCase()
            )
          ) {
            alert("Todo with this title already exists!");
            return false;
          }

          const todo = this.todos.find((t) => t.id === id);
          if (todo) {
            todo.text = trimmedText;
            todo.description = trimmedDescription;
            this.editingId = null;
            this.saveTodos();
            this.render();
            return true;
          }
          return false;
        }

        cancelEdit() {
          this.editingId = null;
          this.render();
        }

        reorderTodos(oldIndex, newIndex) {
          const filteredTodos = this.getFilteredTodos();
          const movedTodo = filteredTodos[oldIndex];

          filteredTodos.splice(oldIndex, 1);
          filteredTodos.splice(newIndex, 0, movedTodo);

          filteredTodos.forEach((todo, index) => {
            const originalTodo = this.todos.find((t) => t.id === todo.id);
            if (originalTodo) {
              originalTodo.order = index;
            }
          });

          this.saveTodos();
          this.render();
        }

        getFilteredTodos() {
          let filtered = [...this.todos];

          switch (this.currentFilter) {
            case "active":
              filtered = filtered.filter((todo) => !todo.completed);
              break;
            case "completed":
              filtered = filtered.filter((todo) => todo.completed);
              break;
          }

          if (this.searchQuery) {
            filtered = filtered.filter((todo) =>
              todo.text.toLowerCase().includes(this.searchQuery) ||
              (todo.description && todo.description.toLowerCase().includes(this.searchQuery))
            );
          }

          return filtered.sort((a, b) => a.order - b.order);
        }

        updateStatistics() {
          const total = this.todos.length;
          const completed = this.todos.filter((t) => t.completed).length;
          const active = total - completed;

          document.getElementById("totalCount").textContent = total;
          document.getElementById("activeCount").textContent = active;
          document.getElementById("completedCount").textContent = completed;
        }

        render() {
          const todoList = document.getElementById("todoList");
          const emptyState = document.getElementById("emptyState");
          const filteredTodos = this.getFilteredTodos();

          this.updateStatistics();
          todoList.innerHTML = "";

          if (filteredTodos.length === 0) {
            emptyState.style.display = "block";
            return;
          }

          emptyState.style.display = "none";

          filteredTodos.forEach((todo, index) => {
            const li = document.createElement("li");
            li.className = `list-group-item todo-item ${
              this.editingId === todo.id ? "edit-mode" : ""
            }`;
            li.dataset.id = todo.id;

            if (this.editingId === todo.id) {
              li.innerHTML = this.getEditTemplate(todo);
            } else {
              li.innerHTML = this.getTodoTemplate(todo, index);
            }

            todoList.appendChild(li);
          });

          this.bindTodoEvents();
        }

        getTodoTemplate(todo, index) {
          return `
            <div class="d-flex align-items-start">
              <div class="drag-handle me-3 text-muted mt-1">
                <i class="bi bi-grip-vertical"></i>
              </div>
              <div class="flex-fill">
                <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    ${todo.completed ? "checked" : ""}
                    data-toggle-id="${todo.id}"
                  >
                  <div>
                    <label class="form-check-label fw-bold ${
                      todo.completed
                        ? "text-decoration-line-through text-muted"
                        : ""
                    }">
                      ${todo.text}
                    </label>
                    ${todo.description ? `
                      <div class="mt-1">
                        <small class="text-muted ${todo.completed ? 'text-decoration-line-through' : ''}">
                          ${todo.description}
                        </small>
                      </div>
                    ` : ''}
                  </div>
                </div>
                <div class="mt-2">
                  <small class="text-muted">
                    <i class="bi bi-calendar3 me-1"></i>
                    Created: ${new Date(todo.createdAt).toLocaleDateString()}
                  </small>
                </div>
              </div>
              <div class="btn-group btn-group-sm ms-2">
                <button class="btn btn-outline-primary" data-edit-id="${
                  todo.id
                }" title="Edit todo">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-outline-danger" data-delete-id="${
                  todo.id
                }" title="Delete todo">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          `;
        }

        getEditTemplate(todo) {
          return `
            <div class="d-flex align-items-start">
              <div class="flex-fill">
                <div class="mb-2">
                  <label class="form-label small">Title:</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    value="${todo.text}"
                    data-edit-input="${todo.id}"
                    placeholder="Todo title..."
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label small">Description:</label>
                  <textarea 
                    class="form-control" 
                    rows="2"
                    data-edit-description="${todo.id}"
                    placeholder="Todo description..."
                  >${todo.description || ''}</textarea>
                </div>
                <div class="btn-group btn-group-sm w-100">
                  <button class="btn btn-success" data-save-id="${todo.id}" title="Save changes">
                    <i class="bi bi-check"></i> Save
                  </button>
                  <button class="btn btn-secondary" data-cancel-edit="true" title="Cancel editing">
                    <i class="bi bi-x"></i> Cancel
                  </button>
                </div>
              </div>
            </div>
          `;
        }

        bindTodoEvents() {
          document.querySelectorAll("[data-toggle-id]").forEach((checkbox) => {
            checkbox.addEventListener("change", () => {
              const id = parseInt(checkbox.dataset.toggleId);
              this.toggleTodo(id);
            });
          });

          document.querySelectorAll("[data-edit-id]").forEach((button) => {
            button.addEventListener("click", () => {
              const id = parseInt(button.dataset.editId);
              this.editTodo(id);
            });
          });

          document.querySelectorAll("[data-delete-id]").forEach((button) => {
            button.addEventListener("click", () => {
              const id = parseInt(button.dataset.deleteId);
              this.deleteTodo(id);
            });
          });

          document.querySelectorAll("[data-save-id]").forEach((button) => {
            button.addEventListener("click", () => {
              const id = parseInt(button.dataset.saveId);
              const input = document.querySelector(`[data-edit-input="${id}"]`);
              const descriptionTextarea = document.querySelector(`[data-edit-description="${id}"]`);
              this.saveEdit(id, input.value, descriptionTextarea ? descriptionTextarea.value : '');
            });
          });

          document.querySelectorAll("[data-cancel-edit]").forEach((button) => {
            button.addEventListener("click", () => {
              this.cancelEdit();
            });
          });

          document.querySelectorAll("[data-edit-input]").forEach((input) => {
            input.addEventListener("keydown", (e) => {
              if (e.key === "Enter") {
                const id = parseInt(input.dataset.editInput);
                const descriptionTextarea = document.querySelector(`[data-edit-description="${id}"]`);
                this.saveEdit(id, input.value, descriptionTextarea ? descriptionTextarea.value : '');
              } else if (e.key === "Escape") {
                this.cancelEdit();
              }
            });

            input.focus();
            input.select();
          });
        }
      }

      // Initialize Todo App when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        new TodoApp();
      });
    </script>
    
    <footer class="bg-light text-center text-muted py-3 mt-5 border-top shadow-sm">
      <div>
        Web created by <span class="fw-bold text-primary">@Wahyu Rizky</span>
      </div>
    </footer>
  </body>
</html>